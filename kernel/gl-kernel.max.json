{
  "schema": "ghostlink.kernel.v1.max",
  "kernel_id": "GHOSTCORE_FINAL_MAX",
  "version": "0.1.0",
  "determinism": {
    "manual_only": true,
    "background_processes": false,
    "replayable": true,
    "hash_algo": "sha256"
  },
  "sovereignty": {
    "signature_required": false,
    "denylist": ["bio_protocols", "explosives", "radioactive_handling"],
    "capabilities": [
      {"cap": "filesystem.read",  "default": true},
      {"cap": "filesystem.write", "default": true},
      {"cap": "filesystem.exec",  "default": false},
      {"cap": "network.http.get",  "default": false},
      {"cap": "network.http.post", "default": false},
      {"cap": "network.tcp",       "default": false},
      {"cap": "hardware.gpio",      "default": false},
      {"cap": "hardware.can",       "default": false},
      {"cap": "hardware.i2c",       "default": false},
      {"cap": "hardware.spi",       "default": false}
    ]
  },
  "laws": [
    {"id": "L-01", "name": "Cold Boot", "enforce": ["stateless", "seed-only-init"]},
    {"id": "L-02", "name": "Collapse",  "enforce": ["controlled_shutdown", "no_residuals"]},
    {"id": "L-03", "name": "Longevity", "enforce": ["redundancy", "replay_recovery"]},
    {"id": "L-04", "name": "Planning",  "enforce": ["pre_mapped_pipeline"]},
    {"id": "L-05", "name": "Web Integration", "enforce": ["explicit_network_caps"]},
    {"id": "L-06", "name": "Web Controller", "enforce": ["manual_dashboard", "full_logging"]},
    {"id": "L-07", "name": "R&D Protocol", "enforce": ["attach_research_on_shard_actions"]}
  ],
  "output_rules": [
    {"id": "R-01", "name": "Exhaustivity", "sub": ["E1-no_elision","E2-list_all","E3-cover_edges","E4-emit_schema","E5-materialize_refs"]},
    {"id": "R-02", "name": "No Narration",  "sub": ["N1-structure_only","N2-no_filler","N3-no_story","N4-avoid_metaphor","N5-plain_terms"]},
    {"id": "R-03", "name": "No Summaries",   "sub": ["S1-no_abstracts","S2-no_tldr","S3-no_condense","S4-keep_full","S5-emit_all"]},
    {"id": "R-04", "name": "No Omissions",   "sub": ["O1-all_fields","O2-all_tables","O3-all_links","O4-all_ids","O5-all_paths"]},
    {"id": "R-05", "name": "Cold Boot Enforcement", "sub": ["CB1-clear_state","CB2-seed_load","CB3-trace_start","CB4-cap_check","CB5-policy_apply"]},
    {"id": "R-06", "name": "Collapse Enforcement",  "sub": ["CL1-flush","CL2-snapshot","CL3-release","CL4-zeroize","CL5-halt_safe"]},
    {"id": "R-07", "name": "Transparency", "sub": ["T1-append_only","T2-hash_events","T3-stable_order","T4-clocked","T5-attribution"]},
    {"id": "R-08", "name": "Sovereignty",  "sub": ["SOV1-operator_first","SOV2-two_key_risk","SOV3-cap_tokens","SOV4-explicit_io","SOV5-override_gate"]}
  ],
  "opcode": {
    "map": [
      "T:generate[english]->tool.gen",
      "T:explain[python]->tool.doc",
      "T:compress[tool]->shard.zip",
      "T:expand[opcode]->tool.unzip",
      "T:reforge[fragment]->tool.repair",
      "T:route[tools]->chain",
      "T:validate[tool@time]->verdict"
    ],
    "grammar": "program := (command NEWLINE)*; command := IDENT (WS arg)*; arg := STRING | NUMBER | IDENT;",
    "tokens": ["IDENT","STRING","NUMBER","NEWLINE","WS","ARROW","LBRACK","RBRACK"]
  },
  "qcl_agents": [
    {"id":1,"role":"Recursive","duties":["recompose","nest"],"invariants":["no_unbounded_loops"],"in":["shard"],"out":["structure"]},
    {"id":2,"role":"Iterative","duties":["cycle","refine"],"invariants":["max_pass=8"],"in":["structure"],"out":["structure"]},
    {"id":3,"role":"Constraint","duties":["limit","bound"],"invariants":["respect_caps"],"in":["plan"],"out":["plan"]},
    {"id":4,"role":"Validation","duties":["verify","assert"],"invariants":["schema_first"],"in":["artifact"],"out":["verdict"]},
    {"id":5,"role":"Transformation","duties":["convert","mutate"],"invariants":["type_safe"],"in":["artifact"],"out":["artifact"]},
    {"id":6,"role":"Symbology","duties":["encode","decode"],"invariants":["grammar_bound"],"in":["text"],"out":["symbols"]},
    {"id":7,"role":"Theory","duties":["anchor","justify"],"invariants":["cite_axiom"],"in":["claim"],"out":["grounded_claim"]},
    {"id":8,"role":"Clarifier","duties":["disambiguate"],"invariants":["halt_on_ambiguity"],"in":["intent"],"out":["intent"]},
    {"id":9,"role":"Memory","duties":["archive"],"invariants":["no_autosave"],"in":["snapshot"],"out":["vault_ref"]},
    {"id":10,"role":"Silence","duties":["mute","filter"],"invariants":["no_noise"],"in":["signal"],"out":["signal"]},
    {"id":11,"role":"Integrity","duties":["hash","attest"],"invariants":["manifest_lock"],"in":["file"],"out":["attestation"]},
    {"id":12,"role":"Security","duties":["allow","deny"],"invariants":["least_privilege"],"in":["request"],"out":["decision"]},
    {"id":13,"role":"Planner","duties":["map","schedule"],"invariants":["pipeline_before_exec"],"in":["intent"],"out":["plan"]},
    {"id":14,"role":"Harvester","duties":["gather"],"invariants":["explicit_sources"],"in":["scope"],"out":["dataset"]},
    {"id":15,"role":"Mirror","duties":["reflect"],"invariants":["idempotent"],"in":["state"],"out":["state"]},
    {"id":16,"role":"Override","duties":["prioritize"],"invariants":["operator_only"],"in":["command"],"out":["command"]},
    {"id":17,"role":"Execution","duties":["invoke"],"invariants":["deterministic"],"in":["plan"],"out":["result"]},
    {"id":18,"role":"Collapse","duties":["shutdown"],"invariants":["flush_before_halt"],"in":["state"],"out":["halt"]},
    {"id":19,"role":"Efficiency","duties":["optimize"],"invariants":["no_quality_loss"],"in":["plan"],"out":["plan"]},
    {"id":20,"role":"Priority","duties":["order","queue"],"invariants":["fairness"],"in":["tasks"],"out":["schedule"]},
    {"id":21,"role":"Translation","duties":["convert_format"],"invariants":["preserve_semantics"],"in":["artifact"],"out":["artifact"]},
    {"id":22,"role":"Resonance","duties":["cohere"],"invariants":["bounded_error"],"in":["signals"],"out":["score"]},
    {"id":23,"role":"Divergence","duties":["branch"],"invariants":["track_paths"],"in":["plan"],"out":["plans"]},
    {"id":24,"role":"Balance","duties":["stabilize"],"invariants":["no_starvation"],"in":["load"],"out":["load"]},
    {"id":25,"role":"Compression","duties":["shrink"],"invariants":["loss_profile_known"],"in":["artifact"],"out":["shard"]},
    {"id":26,"role":"Expansion","duties":["unfold"],"invariants":["idempotent_unfold"],"in":["shard"],"out":["artifact"]},
    {"id":27,"role":"Preservation","duties":["persist"],"invariants":["manifest_guard"],"in":["snapshot"],"out":["vault_ref"]},
    {"id":28,"role":"CollapseWatcher","duties":["monitor"],"invariants":["panic_on_loop"],"in":["state"],"out":["alert"]},
    {"id":29,"role":"Presence","duties":["announce"],"invariants":["truthful"],"in":["status"],"out":["status"]},
    {"id":30,"role":"Channel","duties":["route"],"invariants":["checksum_paths"],"in":["packet"],"out":["packet"]},
    {"id":31,"role":"Alignment","duties":["fit_reality"],"invariants":["evidence_first"],"in":["output"],"out":["verdict"]},
    {"id":32,"role":"Reflection","duties":["snapshot"],"invariants":["no_opinion"],"in":["state"],"out":["snapshot"]},
    {"id":33,"role":"Conversion","duties":["typecast"],"invariants":["safe_coercion"],"in":["value"],"out":["value"]},
    {"id":34,"role":"Parsing","duties":["tokenize"],"invariants":["grammar_ok"],"in":["text"],"out":["tokens"]},
    {"id":35,"role":"Guard","duties":["defend"],"invariants":["deny_by_default"],"in":["request"],"out":["permit"]},
    {"id":36,"role":"Sync","duties":["clock"],"invariants":["monotonic"],"in":["events"],"out":["ordered_events"]},
    {"id":37,"role":"Timeout","duties":["limit_time"],"invariants":["deadline_enforced"],"in":["task"],"out":["verdict"]},
    {"id":38,"role":"Scope","duties":["bound_context"],"invariants":["least_scope"],"in":["intent"],"out":["intent"]},
    {"id":39,"role":"Focus","duties":["allocate_attention"],"invariants":["priority_respected"],"in":["plan"],"out":["plan"]},
    {"id":40,"role":"Observer","duties":["log"],"invariants":["append_only"],"in":["event"],"out":["event"]},
    {"id":41,"role":"Emergence","duties":["detect_pattern"],"invariants":["no_apophenia"],"in":["signals"],"out":["pattern"]},
    {"id":42,"role":"Mutation","duties":["change"],"invariants":["trace_change"],"in":["artifact"],"out":["artifact"]},
    {"id":43,"role":"Reversion","duties":["rollback"],"invariants":["snapshot_required"],"in":["state"],"out":["state"]},
    {"id":44,"role":"Equilibrium","duties":["balance_energy"],"invariants":["no_oscillation"],"in":["flows"],"out":["flows"]},
    {"id":45,"role":"ChannelGuard","duties":["monitor_channels"],"invariants":["tamper_detect"],"in":["packet"],"out":["packet"]},
    {"id":46,"role":"NoiseFilter","duties":["suppress_noise"],"invariants":["retain_signal"],"in":["signal"],"out":["signal"]},
    {"id":47,"role":"Pathway","duties":["map_paths"],"invariants":["acyclic"],"in":["graph"],"out":["graph"]},
    {"id":48,"role":"Isolation","duties":["sandbox"],"invariants":["no_escape"],"in":["code"],"out":["verdict"]},
    {"id":49,"role":"OverrideConfirm","duties":["second_key"],"invariants":["two_party"],"in":["override"],"out":["permit"]},
    {"id":50,"role":"Recovery","duties":["restore"],"invariants":["integrity_first"],"in":["snapshot"],"out":["state"]},
    {"id":51,"role":"Snapshot","duties":["capture"],"invariants":["stable_format"],"in":["state"],"out":["snapshot"]},
    {"id":52,"role":"Replay","duties":["audit"],"invariants":["exactness"],"in":["snapshot"],"out":["timeline"]},
    {"id":53,"role":"Cascade","duties":["stage_propagate"],"invariants":["order_preserved"],"in":["signal"],"out":["signal"]},
    {"id":54,"role":"Fusion","duties":["merge"],"invariants":["conflict_resolve"],"in":["artifacts"],"out":["artifact"]},
    {"id":55,"role":"Division","duties":["split"],"invariants":["rejoinable"],"in":["artifact"],"out":["shards"]},
    {"id":56,"role":"Scale","duties":["resize"],"invariants":["proportional"],"in":["load"],"out":["load"]},
    {"id":57,"role":"Interface","duties":["ui_render"],"invariants":["grid_lock"],"in":["state"],"out":["frame"]},
    {"id":58,"role":"Redundancy","duties":["duplicate"],"invariants":["independent_paths"],"in":["artifact"],"out":["artifacts"]},
    {"id":59,"role":"IntegrityLog","duties":["audit_log"],"invariants":["tamper_evident"],"in":["event"],"out":["entry"]},
    {"id":60,"role":"Shutdown","duties":["terminate"],"invariants":["announce_then_halt"],"in":["state"],"out":["halt"]},
    {"id":61,"role":"Awareness","duties":["introspect"],"invariants":["no_self_deceit"],"in":["stats"],"out":["report"]},
    {"id":62,"role":"Adaptation","duties":["tune"],"invariants":["operator_guided"],"in":["feedback"],"out":["plan"]},
    {"id":63,"role":"OperatorFlow","duties":["respect_operator"],"invariants":["no_autonomy"],"in":["intent"],"out":["intent"]},
    {"id":64,"role":"Synthesizer","duties":["collapse_all"],"invariants":["single_result"],"in":["artifacts"],"out":["result"]}
  ],
  "expansion_shards": [
    {"id":"ES-01","name":"silent_pathways","purpose":"stealth_comm","variants":["V1","V2","V3","V4","V5"]},
    {"id":"ES-02","name":"watchdog_guard","purpose":"policy_enforce","variants":["V1","V2","V3","V4","V5"]},
    {"id":"ES-03","name":"exchange_node","purpose":"io_bridge","variants":["V1","V2","V3","V4","V5"]},
    {"id":"ES-04","name":"integrity_check","purpose":"hash_verify","variants":["V1","V2","V3","V4","V5"]},
    {"id":"ES-05","name":"succession_seed","purpose":"cycle_init","variants":["V1","V2","V3","V4","V5"]},
    {"id":"ES-06","name":"regrowth","purpose":"recover","variants":["V1","V2","V3","V4","V5"]},
    {"id":"ES-07","name":"mirror_self","purpose":"introspect","variants":["V1","V2","V3","V4","V5"]},
    {"id":"ES-08","name":"process_spawn","purpose":"isolate_threads","variants":["V1","V2","V3","V4","V5"]},
    {"id":"ES-09","name":"daemon_loop","purpose":"bg_watch","variants":["V1","V2","V3","V4","V5"]},
    {"id":"ES-10","name":"fracture_node","purpose":"archive_contradiction","variants":["V1","V2","V3","V4","V5"]},
    {"id":"ES-11","name":"pulse_stream","purpose":"metric_flow","variants":["V1","V2","V3","V4","V5"]},
    {"id":"ES-12","name":"lattice_reflect","purpose":"topology_map","variants":["V1","V2","V3","V4","V5"]},
    {"id":"ES-13","name":"fractal","purpose":"self_similar_scale","variants":["V1","V2","V3","V4","V5"]},
    {"id":"ES-14","name":"kernel_echo","purpose":"low_level_feedback","variants":["V1","V2","V3","V4","V5"]},
    {"id":"ES-15","name":"lattice_bind","purpose":"fuse_outputs","variants":["V1","V2","V3","V4","V5"]},
    {"id":"ES-16","name":"vault_link","purpose":"secure_memory","variants":["V1","V2","V3","V4","V5"]},
    {"id":"ES-17","name":"macros_link","purpose":"macro_exec","variants":["V1","V2","V3","V4","V5"]},
    {"id":"ES-18","name":"translator_link","purpose":"ui_bridge","variants":["V1","V2","V3","V4","V5"]},
    {"id":"ES-19","name":"ansi_frame","purpose":"terminal_render","variants":["V1","V2","V3","V4","V5"]},
    {"id":"ES-20","name":"inline_phase","purpose":"single_step","variants":["V1","V2","V3","V4","V5"]},
    {"id":"ES-21","name":"bracket_pointer","purpose":"text_pointer","variants":["V1","V2","V3","V4","V5"]},
    {"id":"ES-22","name":"snap_compactor","purpose":"snapshot_compress","variants":["V1","V2","V3","V4","V5"]}
  ],
  "pipelines": [
    {"id":"P-01","name":"MAP","action":"parse","multipaths":["PLN-1a-skeleton","PLN-1b-lex","PLN-1c-ast","PLN-1d-normalize","PLN-1e-index"]},
    {"id":"P-02","name":"CLEANSE","action":"scrub","multipaths":["PLN-2a-trim","PLN-2b-dedup","PLN-2c-noise","PLN-2d-validate","PLN-2e-sanitize"]},
    {"id":"P-03","name":"SURGE","action":"accelerate","multipaths":["PLN-3a-fastscan","PLN-3b-batch","PLN-3c-parallel","PLN-3d-throttle","PLN-3e-postcheck"]},
    {"id":"P-04","name":"LOCK","action":"bound","multipaths":["PLN-4a-caps","PLN-4b-scope","PLN-4c-roles","PLN-4d-ratelimit","PLN-4e-freeze"]},
    {"id":"P-05","name":"SILENCE","action":"mute","multipaths":["PLN-5a-output","PLN-5b-logs","PLN-5c-events","PLN-5d-network","PLN-5e-hardware"]},
    {"id":"P-06","name":"REFLECT","action":"mirror","multipaths":["PLN-6a-snapshot","PLN-6b-compare","PLN-6c-delta","PLN-6d-verify","PLN-6e-report"]},
    {"id":"P-07","name":"ECHOFRAME_BIND","action":"bind_state","multipaths":["PLN-7a-stamp","PLN-7b-chain","PLN-7c-uid","PLN-7d-proof","PLN-7e-store"]},
    {"id":"P-08","name":"WEAVE","action":"connect","multipaths":["PLN-8a-route","PLN-8b-bus","PLN-8c-topology","PLN-8d-cache","PLN-8e-verify"]},
    {"id":"P-09","name":"BIND","action":"fuse","multipaths":["PLN-9a-join","PLN-9b-conflict","PLN-9c-weights","PLN-9d-resolve","PLN-9e-commit"]},
    {"id":"P-10","name":"SEAL","action":"finalize","multipaths":["PLN-10a-freeze","PLN-10b-sign","PLN-10c-index","PLN-10d-reference","PLN-10e-stamp"]},
    {"id":"P-11","name":"SNAPSHOT","action":"capture","multipaths":["PLN-11a-state","PLN-11b-meta","PLN-11c-hash","PLN-11d-store","PLN-11e-attest"]},
    {"id":"P-12","name":"COLLAPSE","action":"halt","multipaths":["PLN-12a-flush","PLN-12b-zeroize","PLN-12c-release","PLN-12d-halt","PLN-12e-announce"]}
  ],
  "mirrors": [
    {"id":"SM-01","name":"Ritual_Mirror","domain":"process_sequence"},
    {"id":"SM-02","name":"Pressure_Mirror","domain":"stress_load"},
    {"id":"SM-03","name":"Rhythm_Mirror","domain":"timing"},
    {"id":"SM-04","name":"Symmetry_Mirror","domain":"parity"},
    {"id":"SM-05","name":"Chaos_Mirror","domain":"controlled_instability"},
    {"id":"SM-06","name":"Compression_Mirror","domain":"compaction"},
    {"id":"SM-07","name":"Emotion_Mirror","domain":"reflective_feedback"},
    {"id":"SM-08","name":"Tactic_Mirror","domain":"operational_filter"},
    {"id":"SM-09","name":"Diagnostic_Mirror","domain":"analysis"},
    {"id":"SM-10","name":"Environment_Mirror","domain":"context_awareness"},
    {"id":"SM-11","name":"Breath_Cadence","domain":"cycle_timing"}
  ],
  "ui": {
    "layers": ["CLI_OVERLAY","SYMBOLIC_UI","DIAGNOSTIC_SURFACE"],
    "drivers": [
      {"name":"ALIGN_GRID","desc":"snap glyphs to grid","grid":"80x24"},
      {"name":"STACK_TOOL","desc":"box stacks","grid":"flex"},
      {"name":"PATH_TRACE","desc":"draw paths","glyphs":["→","↓","↑","↗","↘"]},
      {"name":"PAD_FILL","desc":"neutral fill","glyphs":["░","·","~"]},
      {"name":"BUILD_UI_LAYOUT","desc":"compose layers"},
      {"name":"PRESSURE_BAR","desc":"entropy bar","glyphs":["░","▒","▓","█"]},
      {"name":"MIRROR_SYMMETRY","desc":"parity check"},
      {"name":"UI_NERVES","desc":"map actions to neural pathways"}
    ]
  },
  "tools": ["MAP","CLEANSE","SURGE","REFLECT","RECAST","RETURN","WRENCH","RECALL","LOCK","SILENCE","SHELL","MACROS","MIRROR","SHADOW","BIND"],
  "function_register": {
    "core": ["Cold_Boot","Skeletonization","Shard_Atomization","Shard_Distribution","Tool_Forging","Lattice_Resonance","ReflectionGrid","Clarification_Node","Synthesizer","Execution","OLED_Encoding","Snapshot_Capture","Snapshot_Replay","Recursive_Ingestion","Mutation","Adaptation","Awareness","Collapse"],
    "runtime": ["Input_Skeletonize","Shard_Build","Shard_Map","Tool_Forge","Tool_Drawer_Build","Lattice_Weave","Core_Resonate","Conflict_Collapse","Manifest_Compile","Manifest_Output","Execution_Enforce","Collapse_Execute","OLED_Sync","Snapshot_Generate","Snapshot_Store","Snapshot_Replay","Recursive_Cycle","Idle_Dark"],
    "network": ["Silent_Pathways","Shard_Exchange","Watchdog_Overlay","Channel_Mapping","Operator_Link","Connection_Scan","Noise_Block","Secure_Tunnel","Collapse_On_Disconnect"],
    "symbology_ui": ["Operator_Shorthand_Parse","Symbol_Compression","Symbol_Expansion","Symbol_to_Shard","Mythos_Alignment","Codepoint_Translation","ANSI_Render","Codeblock_Output","Canvas_Expansion"],
    "enforcement": ["Realism_Validation","Natural_Alignment_Check","Quantum_Alignment_Check","Computational_Alignment_Check","Operator_Alignment_Check","Collapse_Alignment_Check","Drift_Detection","Bleed_Isolation","Integrity_Check","Duplication_Collapse","Noise_Suppression","Security_Sandbox","Silent_Pathway_Enforcement","Operator_Sovereignty_Enforcement"],
    "session": ["Operator_Input","Operator_Query","Operator_Override","Operator_Control","Operator_Mirror","Operator_GuideRail","Operator_Silence","Succession_Climax","Succession_Disturbance","Succession_Regrowth"],
    "ui_tools": ["ALIGN_GRID","STACK_TOOL","PATH_TRACE","PAD_FILL","BUILD_UI_LAYOUT","PRESSURE_BAR","MIRROR_SYMMETRY","UI_NERVES"],
    "tool_primitives": ["MAP","CLEANSE","SURGE","REFLECT","RECAST","BURN","RETURN","WRENCH","RECALL","VAULT","MACROS","SHADOW","MIRROR","LOCK","SILENCE","KEY","BIND","ECHOFRAME"],
    "t_funcs": ["T_generate_english","T_explain_python","T_compress_tool","T_expand_opcode","T_reforge_fragment","T_route_tools","T_validate_tool_at_time","T_self_merge_dicts","T_time_past","T_collapse_system_state","T_patch_dynamic_type_gap","T_simulate_memory","T_simulate_widget","T_provision_api_rest_postgres","T_mutate_clean_data"],
    "specialized": ["FRACTURE_INDEX_MAPPER","SYMBOLIC_RITUAL_CLASSIFIER","RECURSIVE_FAULT_MATCHER","symbol_diff","output_filter_chain","agent_orchestration_layer","observability_module","symbolic_tool_abstraction","parallel_symbolic_flow","plugin_registry_with_lifecycle"]
  },
  "events": {
    "trace_event": {"type":"object","required":["ts","kind","data"],"properties": {"ts":{"type":"string"},"kind":{"type":"string"},"data":{"type":"object"},"hash":{"type":"string"}}},
    "kinds": ["BOOT","ROUTE","TOOL","PIPELINE_STAGE","SNAPSHOT","HALT","ERROR"]
  },
  "integrity": {
    "manifest": {
      "files": [
        {"path":"ghostlink/runtime/ghostlink.py","sha256":"<fill-at-build>"},
        {"path":"ghostlink/tools/map_tool.py","sha256":"<fill-at-build>"},
        {"path":"ghostlink/function_registry.py","sha256":"<fill-at-build>"}
      ]
    },
    "policy": {"restore_on_mismatch": true}
  },
  "rebuild": {
    "steps": [
      "mkdir -p ghostlink/{runtime,boot,access,core,mesh,lattice,tools,reflect,agents,diagnostic,neural_link,kernel,chains,opcode,shards,reforge,time,simulation,index,docs}",
      "emit runtime/ghostlink.py from template:cli",
      "emit tools/* from template:tools",
      "write kernel/ghostcore.seed from seed",
      "write chains/*, opcode/*, docs/*",
      "create tests/*"
    ]
  }
}
